<script>
  // --- Site configuration from Jekyll data ---
  const SITE = {
    ownerName: "{{ site.data.site.owner_name }}",
    tagline: "{{ site.data.site.tagline }}",
    email: "{{ site.data.site.email }}",
    location: "{{ site.data.site.location }}",
    githubUser: "{{ site.data.site.github_user }}",
    avatar: "{{ site.data.site.avatar }}",
    social: {
      github: "{{ site.data.site.social.github }}",
      x: "{{ site.data.site.social.x }}",
      huggingface: "{{ site.data.site.social.huggingface }}",
      reddit: "{{ site.data.site.social.reddit }}",
      linkedin: "{{ site.data.site.social.linkedin }}",
      email: "{{ site.data.site.social.email }}"
    }
  };

  // --- Theme ---
  const applyTheme = (t) => {
    const root = document.documentElement;
    // Remove both classes first for clean state
    root.classList.remove('dark', 'light');
    // Add the appropriate class
    root.classList.add(t);
    
    const themeIcon = document.querySelector('.i-theme');
    if (themeIcon) themeIcon.textContent = t === 'dark' ? 'ðŸŒ™' : 'ðŸŒž';
    localStorage.setItem('theme', t);
  }
  
  const initTheme = () => {
    const pref = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    applyTheme(pref);
  }
  
  // Apply theme immediately before DOMContentLoaded to prevent FOUC
  (() => {
    const savedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = savedTheme || (prefersDark ? 'dark' : 'light');
    document.documentElement.classList.add(theme);
  })();

  // --- Populate dynamic content ---
  const byId = (id) => document.getElementById(id);
  
  // --- Contact form ---
  const setupContactForm = () => {
    const contactForm = document.getElementById('contactForm');
    if (contactForm) {
      contactForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const formData = new FormData(contactForm);
        const name = formData.get('name') || '';
        const email = formData.get('email') || '';
        const subject = formData.get('subject') || 'Contact from WCNegentropy.com';
        const message = formData.get('message') || '';
        
        if (!name.trim() || !email.trim() || !message.trim()) {
          alert('Please fill in all required fields.');
          return;
        }
        
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          alert('Please enter a valid email address.');
          return;
        }
        
        const emailBody = `Name: ${name}%0D%0AEmail: ${email}%0D%0A%0D%0AMessage:%0D%0A${message}`;
        const mailtoUrl = `mailto:${SITE.email}?subject=${encodeURIComponent(subject)}&body=${emailBody}`;
        
        window.location.href = mailtoUrl;
        
        const button = contactForm.querySelector('button[type="submit"]');
        const originalText = button.textContent;
        button.textContent = 'âœ“ Opening Email Client...';
        button.disabled = true;
        button.classList.add('bg-green-600', 'hover:bg-green-700');
        button.classList.remove('bg-brand-600', 'hover:bg-brand-700');
        
        setTimeout(() => {
          button.textContent = originalText;
          button.disabled = false;
          button.classList.remove('bg-green-600', 'hover:bg-green-700');
          button.classList.add('bg-brand-600', 'hover:bg-brand-700');
          contactForm.reset();
        }, 3000);
      });
    }
  }

  // --- Initialize site ---
  const initializeSite = () => {
    try {
      // Set year in footer
      const yearEl = byId('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();
      
      // Setup contact form
      setupContactForm();
    } catch (error) {
      console.error('Site initialization error:', error);
    }
  };

  // --- On load ---
  document.addEventListener('DOMContentLoaded', () => {
    initTheme();
    document.getElementById('theme-toggle')?.addEventListener('click', () => {
      const t = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
      applyTheme(t);
    });
    initializeSite();
  });
</script>
